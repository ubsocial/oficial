<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="../anexos/icons/logoTit.png">
    <link rel="stylesheet" href="../estilo.css">
    <title>UB Social</title>
</head>
<body>
<div class="container-fluid">


    <div class="row">
        <div class="col-sm-12">
            <nav class="navbar rounded-bottom fixed-top navbar-expand-lg navbar-light bg-light shadow">
                <div class="container-fluid">
                    <a class="navbar-brand" href="../index.html"><img src="../anexos/icons/logo.png" class="d-inline-block align-text-top" id="logo"> UB Social</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="../contato.html">Contato</a></li>
                            <li class="nav-item"><a class="nav-link" href="../livros.html">Livros</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12" id="titulo">
            <h1>API, REST, RESTful</h1>
            <h6><strong>Criar API REST com Laravel</strong></h6>
            <a href="../index.html" class="btn btn-link text-decoration-none">Voltar</a>
        </div>

        <div class="col-sm-12">
            <h4>Conceitos</h4>
            <p id="textoPost"><b>API</b>:<br>Application Programming Interface tem função de intermediar comunicação universal entre diferentes sistemas, assim como do banco de dados com o próprio sistema (Interno ou externo), utilizando protocolo de comunicação HTTP (XML/JSON), requisitados via URL específica, independente da tecnologia do sistema que irá consumí-la (Acessá-la). Pode-se solicitar dados via API, através de métodos como POST, assim como a API poderá fornecer-lhe dados, via métodos como GET. Em ambos casos, utilizando a comunicação universal citada. Funcionamento: Front-end requisita, via URL específica, rotinas ao Back-end. Conforme URL, serão realizadas rotinas de código com acesso/manipulação ao Banco de Dados. Após isso, Back-end envia feedback, em formato XML/JSON, para Front-end. Todo o processo descrito realizado no Back-end é o conceito de API.</p>
            <p id="textoPost"><b>REST</b>:<br>Representational State Transfer. Técnica que consiste em princípios que, quando seguidos, permitem a criação de projetos (Web services) com interfaces/arquitetura bem definidas, utilizando novos métodos REST HTTP, como PUT e DELETE. Os Web services que estão em conformidade com o estilo arquitetural REST são denominados Web services RESTful. Em síntese, API que intermedia a comunicação do Front-end com o Back-end do sistema, fazendo-os se conversarem por meio de linguagem XML/JSON utilizando métodos REST (Front-end solicita coisas via URL ao Back-end que, por meio de padrões de código e métodos REST (Como DELETE, UPDATE...), cria JSON com resposta e o reenvia ao Front-end, que organizará visualmente o conteúdo ao usuário, técnica chamada <i>Consumir API</i>).</p>
            <p id="textoPost"><b>RESTful</b>:<br>Nome de categoria dado ao sistema que utiliza API REST em seu funcionamento. (<u>Ex</u>: "O sistema XYZ é RESTful". Portanto, o sistema XYZ funciona por meio de API REST). Para que uma API seja RESTful, precisa seguir os seguintes critérios:</p>
            <ol class="text-muted">
                <li>Ter arquitetura cliente/servidor formada por clientes, servidores e recursos, com solicitações gerenciadas via HTTP;</li>
                <li>Realizar comunicação cliente/servidor stateless, onde cada solicitação é separada e não conectada com outras, e que nenhuma informação do cliente é armazenada entre elas;</li>
                <li>Armazenar dados em cache para otimizar as interações entre cliente/servidor;</li>
                <li>Ter interface uniforme entre os componentes para que as informações sejam transferidas em formato padronizado. Para tanto, é necessário que: 4.1. Recursos solicitados sejam identificáveis e estejam separados das representações enviadas ao cliente; 4.2. Recursos possam ser manipulados pelo cliente por meio da representação recebida com informações suficientes para tais ações; 4.3. Mensagens autodescritivas retornadas ao cliente contenham informações suficientes para descrever como processá-las; 4.4. Hipermídia seja incorporada, onde, após acessar um recurso, o cliente precisa ser capaz de usar hiperlinks para encontrar todas as demais ações disponíveis para ele no momento.</li>
                <li>Ter um sistema em camadas que organiza os tipos de servidores (Responsáveis pela segurança, pelo carregamento de carga e assim por diante) envolvidos na recuperação das informações solicitadas em hierarquias que o cliente não pode ver;</li>
                <li>Possibilitar código sob demanda (Opcional): a capacidade de enviar do servidor para o cliente um código executável quando solicitado, a fim de ampliar as funções do cliente.</li>
            </ol>
            
            <br><h4>Funcionamento prático</h4>
            <p id="textoPost">Aplicação Front-end envia requisição HTTP com métodos REST para Back-end, que, de acordo com a URL, realizará determinadas rotinas e gerará um JSON com os resultados da requisição. Essa requisição, geralmente, será reenviada ao Front-end, que o 'consumirá' em um layout interativo ao usuário.</p>
            <p id="textoPost"><u>Exemplo consultar dados de cliente</u>: Usuário clica em Consultar Cliente, que enviará URL requisitando dados do cliente ao Back-end. Conforme parâmetros na URL requisitada (ID do usuário, URL via método GET), com isso, o Back-end, por meio da API REST (Métodos e padrões de código) com Laravel, consultará BD e criará JSON com resultado dos dados do cliente solicitado e o enviará de volta ao Front-end, que lerá o JSON (Consumir API REST) com React, mostrando os dados do cliente em interface gráfica agradável para o usuário.</p>

            <br><h4>Pré-instalações</h4>
            <ol>
                <li>Instalação e configuração do Laravel (Ver resumo Laravel: <a href="../resumos/laravel.html" class="text-decoration-none" target="_blank">Acesse</a>)</li>
                <li>Instalar Postman
                    <ol>
                        <li>Baixar, no site oficial, Postman Client (.tar.xz) e extraí-lo;</li>
                        <li>No diretório do Postman, realizar os comandos: <i>sudo mv Postman /opt && sudo ln -s /opt/Postman/Postman /usr/local/bin/postman</i>
                        </li>
                        <li>Criar lançador desktop para fácil acesso: sudo nano /usr/share/applications/postman.desktop:</li>
<small><pre><code>
(Conteúdo dentro de poastman.desktop)
[Desktop Entry]
Type=Application
Name=Postman
Icon=/opt/Postman/app/resources/app/assets/icon.png
Exec="/opt/Postman/Postman"
Comment=Postman GUI
Categories=Development;Code;
</code></pre></small>
                        <li>O Postman também pode ser acessado informando '<i>postman</i>' no shell</li>
                    </ol>
                </li>
                <li>Criar BD: Iniciar Apache e MySQL XAMPP e, no Phpmyadmin, criar BD: '<i>CREATE DATABASE artigos;</i>'</li>
                <li>Criar projeto Laravel: '<i>composer create-project --prefer-dist laravel/laravel laravelApiRest</i>'</li>
                <li>Configurar BD em .env: '<i>DB_DATABASE=artigos</i>'</li>
            </ol>

            <br><h4>Passo a passo</h4>
            <a href="https://github.com/mateusschwede/laravel_api_rest" clas class="text-decoration-none" ="btn btn-link" target="_blank">Github projeto</a>
            <ol>
                <li>Criar Model, migration e Controller: <i>php artisan make:model Artigo -m php artisan make:controller ArtigoController --resource</i></li>
                <li>Configurar Migration create_artigos_table.php (Após código, realizar comando '<i>php artisan migrate</i>')</li>
<small><pre><code>
&lt;?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateArtigosTable extends Migration {

    public function up() {
        Schema::create('artigos', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;string('titulo');
            $table-&gt;text('conteudo');
            $table-&gt;timestamps();
        });
    }

    public function down() {
        Schema::dropIfExists('artigos');
    }
}
</code></pre></small>
                <li>Definir Controller ArtigoController</li>
<small><pre><code>
&lt;?php
namespace App\Http\Controllers;
use App\Models\Artigo as Artigo;
use App\Http\Resources\Artigo as ArtigoResource;
use Illuminate\Http\Request;

class ArtigoController extends Controller {

    public function index() {
        $artigos = Artigo::paginate(15);
        return ArtigoResource::collection($artigos);
    }

    public function show($id) {
        $artigo = Artigo::findOrFail( $id );
        return new ArtigoResource($artigo);
    }

    public function store(Request $request) {
        $artigo = new Artigo;
        $artigo-&gt;titulo = $request-&gt;input('titulo');
        $artigo-&gt;conteudo = $request-&gt;input('conteudo');

        if($artigo-&gt;save()) {
            return new ArtigoResource($artigo);
        }
    }

    public function update(Request $request) {
        $artigo = Artigo::findOrFail($request-&gt;id);
        $artigo-&gt;titulo = $request-&gt;input('titulo');
        $artigo-&gt;conteudo = $request-&gt;input('conteudo');

        if(artigo-&gt;save()) {
            return new ArtigoResource($artigo);
        }
    } 

    public function destroy($id) {
        $artigo = Artigo::findOrFail($id);
        if($artigo-&gt;delete()) {
            return new ArtigoResource($artigo);
        }
    }
}
</code></pre></small>
                <li>Criar Routes em routes/api.php</li>
<small><pre><code>
&lt;?php
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ArtigoController;

Route::middleware('auth:api')-&gt;get('/user', function (Request $request) {
    return $request-&gt;user();
});

Route::get('artigos',[ArtigoController::class,'index']); //Listar artigos
Route::get('artigo/{id}',[ArtigoController::class,'show']); //Ver artigo
Route::post('artigo',[ArtigoController::class,'store']); //Criar artigo
Route::put('artigo/{id}',[ArtigoController::class,'update']); //Editar artigo
Route::delete('artigo/{id}',[ArtigoController::class,'destroy']); //Excluir artigo
</code></pre></small>
                <li>Criar Resource em app/Http/Resources/Artigo.php: '<i>php artisan make:resource Artigo</i>'</li>
<small><pre><code>
&lt;?php
namespace App\Http\Resources;
use Illuminate\Http\Resources\Json\JsonResource;

class Artigo extends JsonResource {

    public function toArray($request){
        //return parent::toArray($request);
        return [
            'id' =&gt; $this-&gt;id,
            'titulo' =&gt; $this-&gt;titulo,
            'conteudo' =&gt; $this-&gt;conteudo
        ];
    }

    /* public function with( $request ){
        return [
            'version' =&gt; '1.0.0',
            'author_url' =&gt; url('https://ubsocial.github.io')
        ];
    } */
}
</code></pre></small>
                <li>Executar projeto Laravel: '<i>php artisan serve</i>' (<a href="http://127.0.0.1:8000" class="text-decoration-none" target="_blank">http://127.0.0.1:8000</a>)</li>
                
                <br><h5>Testes no Postman</h5>
                <img src="../anexos/apiRest/postman.png" class="img-fluid rounded" width="500px">
                <li>No Postman, testar API para inserir artigo: (Deverá retornar JSON e inserir no BD)<span class="text-muted"><br>POST: <a href="http://127.0.0.1:8000/api/artigo" class="text-decoration-none" target="_blank">http://127.0.0.1:8000/api/artigo</a><br>(Headers)<br>Key: Content-Type<br>Value: application/json<br>(Body raw) (Enviar 1 bloco de chaves por vez)</span></li>
<small><pre><code>
{
    "titulo": "Primeiro artigo pelo Postman",
    "conteudo": "Descrição desse artigo de número um."
}

{
    "titulo": "Segundo artigo pelo Postman",
    "conteudo": "Descrição desse artigo de número dois."
}

{
    "titulo": "Terceiro artigo pelo Postman",
    "conteudo": "Descrição desse artigo de número três."
}
</code></pre></small>
                <li>No Postman, testar API para listar artigos: (Mostrará em data no JSON)<br><span class="text-muted">GET: <a href="http://127.0.0.1:8000/api/artigos" class="text-decoration-none" target="_blank">http://127.0.0.1:8000/api/artigos</a></span></li>
                <li>No Postman, testar API para ver somente o 1º artigo:<br><span class="text-muted">GET: <a href="http://127.0.0.1:8000/api/artigo/1" class="text-decoration-none" target="_blank">http://127.0.0.1:8000/api/artigo/1</a></span></li>
                <li>No Postman, testar API para editar o artigo 1:<br><span class="text-muted">PUT: <a href="http://127.0.0.1:8000/api/artigo/1" class="text-decoration-none" target="_blank">http://127.0.0.1:8000/api/artigo/1</a><br>(Headers)<br>Key: Content-Type<br>Value: application/json<br>(Body raw)</span></li>
<small><pre><code>
{
    "titulo": "ATUALIZANDO Primeiro artigo pelo Postman",
    "conteudo": "Descrição desse artigo de número um sendo ATUALIZADO."
}
</code></pre></small>
                <li>No Postman, testar API para remover o artigo 1:<br><span class="text-muted">DELETE: <a href="http://127.0.0.1:8000/api/artigo/1" class="text-decoration-none" target="_blank">http://127.0.0.1:8000/api/artigo/1</a></span></li>
            </ol>
        </div>
    </div>


<!--Rodapé-->
<div class="row">
    <div class="col-sm-12 text-center" id="rodape">
        <p>Elaborado por Mateus Schwede<br><small class="text-muted">ubsocial.github.io</small></p>
    </div>
</div>

</div>
</body>
</html>