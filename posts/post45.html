<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="../icons/logoTit.png">
    <link rel="stylesheet" href="../estilo.css">
    <title>UB Social</title>
</head>
<body>
<div class="container-fluid">


    <div class="row">
        <div class="col-sm-12">
            <nav class="navbar rounded-bottom fixed-top navbar-expand-lg navbar-light bg-light shadow">
                <div class="container-fluid">
                    <a class="navbar-brand" href="../index.html"><img src="../icons/logo.png" class="d-inline-block align-text-top" width="11pt"> UB Social</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="../sobre/sobre.html">Sobre</a></li>
                            <li class="nav-item"><a class="nav-link" href="../livros/livros.html">Livros</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 text-center" id="titulo">
            <h1>Vue.js consumir API REST</h1>
            <h6><strong>Consumir API REST Django com Vue.js</strong></h6>
            <a href="../index.html" class="btn btn-link text-decoration-none mb-3">Voltar</a><br>
            <a href="" class="btn btn-link text-decoration-none disabled" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="1.3em" height="1.3em" fill="currentColor" class="bi bi-youtube text-danger" viewBox="0 0 16 16"><path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31.4 31.4 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788 0 0 1 7.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg> Conteúdo disponível</a><br>
        </div>

        <div class="col-sm-12">
            <h4>Objetivo:</h4>
            <p id="textoPost">Consumir API REST Django de músicas, via projeto Vue.js.</p>
            <ul>
                <li>Pré-requisitos: Python, PIP, Node.js, npm</li>
                <li>Instalar Django: pip3 install django djangorestframework markdown django-filter django-cors-headers --break-system-packages</li>
                <li>Instalar Vue.js: npm install -g @vue/cli</li>
            </ul>

            <br><h4>API REST Django:</h4>
            <ol>
                <li>Baixar API REST GitHub (musicApiRest): <a href="https://github.com/mateusschwede/apiRest/tree/main/vuejs_consumir_api_rest" target="_blank" class="text-decoration-none">Acesse</a></li>
                <li>Entrar na pasta da API REST (musicApiRest) e executar os comandos:
<small><pre><code>
python3 manage.py makemigrations
python3 manage.py migrate
python3 manage.py runserver
</code></pre></small>
                </li>
                <li>Rotas de acesso:
<small><pre><code>
<b>Listar musics</b>: (GET) http://localhost:8000/api/musics/
<b>Adicionar music</b>: (POST) http://localhost:8000/api/musics/ (json) &#123; "title": "Nome da música", "artist": "Nome do artista" &#125;
<b>Ver music 1</b>: (GET) http://localhost:8000/api/musics/1/
<b>Atualizar music 1</b>: (PUT) http://localhost:8000/api/musics/1/ (json) &#123; "title": "Nome da música", "artist": "Nome do artista" &#125;
<b>Deletar music 1</b>: (DELETE) http://localhost:8000/api/musics/1/
</code></pre></small>
                </li>
            </ol>

            <br><h4>Vue.js:</h4>
            <ol>
                <li>No mesmo diretório em que encontra-se pasta da API REST Django, criar projeto Vue.js: vue create music-vue</li>
                <li>Entrar na pasta do projeto (music-vue), e instalar Axios: npm install axios</li>
                <li>Informar conteúdo nos arquivos, conforme abaixo</li>
                <li>Executar projeto: npm run dev</li>
            </ol>

            <br><p>src/main.js:</p>
<small><pre><code>
import &#123; createApp &#125; from 'vue';
import App from './App.vue';
import axios from 'axios';

const app = createApp(App);
app.config.globalProperties.$axios = axios;
app.mount('#app');
</code></pre></small>

            <br><p>src/App.vue:</p>
<small><pre><code>
&lt;template&gt;
  &lt;div id="app"&gt;
      &lt;ListMusic /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import ListMusic from './components/ListMusic.vue';

export default &#123;
  components: &#123; ListMusic &#125;,
&#125;;
&lt;/script&gt;
</code></pre></small>

            <br><p>src/components/AddMusic.vue:</p>
<small><pre><code>
&lt;template&gt;
    &lt;div&gt;
        &lt;h2&gt;Adicionar Música&lt;/h2&gt;
        &lt;form @submit.prevent="addMusic"&gt;
            &lt;input v-model="title" placeholder="Título" required&gt;
            &lt;input v-model="artist" placeholder="Artista" required&gt;
            &lt;button type="submit"&gt;Adicionar&lt;/button&gt;
            &lt;button type="button" @click="$emit('cancel')"&gt;Cancelar&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default &#123;
    data() &#123;
        return &#123;
            title: '',
            artist: '',
        &#125;;
    &#125;,
    methods: &#123;
        async addMusic() &#123;
            await this.$axios.post('http://localhost:8000/api/musics/', &#123;
                title: this.title,
                artist: this.artist,
            &#125;);
            this.$emit('music-added');
            this.title = '';
            this.artist = '';
        &#125;,
    &#125;,
&#125;;
&lt;/script&gt;
</code></pre></small>

            <br><p>src/components/ConfirmDialog.vue:</p>
<small><pre><code>
&lt;template&gt;
    &lt;div class="confirm-dialog"&gt;
        &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;
        &lt;button @click="$emit('confirm')"&gt;Sim&lt;/button&gt;
        &lt;button @click="$emit('cancel')"&gt;Não&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default &#123;
    props: ['message'],
&#125;;
&lt;/script&gt;
</code></pre></small>

            <br><p>src/components/EditMusic.vue:</p>
<small><pre><code>
&lt;template&gt;
    &lt;div&gt;
        &lt;h2&gt;Editar Música&lt;/h2&gt;
        &lt;form @submit.prevent="updateMusic"&gt;
            &lt;input v-model="editedMusic.title" placeholder="Título da música" required&gt;
            &lt;input v-model="editedMusic.artist" placeholder="Artista" required&gt;
            &lt;button type="submit"&gt;Salvar&lt;/button&gt;
            &lt;button type="button" @click="$emit('cancel')"&gt;Cancelar&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default &#123
    props: &#123
        music: &#123
            type: Object,
            required: true,
        &#125;,
    &#125;,
    data() &#123
        return &#123
            editedMusic: &#123 ...this.music &#125;,
        &#125;;
    &#125;,
    methods: &#123
        async updateMusic() &#123
            try &#123
                await this.$axios.put(`http://localhost:8000/api/musics/$&#123this.editedMusic.id&#125;/`, &#123
                    title: this.editedMusic.title,
                    artist: this.editedMusic.artist,
                &#125;);
                this.$emit('updated');
            &#125; catch (error) &#123
                console.error('Erro ao atualizar música:', error);
            &#125;
        &#125;,
    &#125;,
&#125;;
&lt;/script&gt;
</code></pre></small>

            <br><p>src/components/ListMusic.vue:</p>
<small><pre><code>
&lt;template&gt;
    &lt;div&gt;
        &lt;h1&gt;Lista de Músicas&lt;/h1&gt;

        &lt;div v-if="activeForm === null"&gt;
            &lt;button @click="showForm('add')"&gt;Adicionar Música&lt;/button&gt;
        &lt;/div&gt;

        &lt;AddMusic v-if="activeForm === 'add'" @music-added="onMusicAdded" @close="closeForm" @cancel="closeForm" /&gt;

        &lt;EditMusic v-if="activeForm === 'edit'" :music="editingMusic" @updated="onMusicUpdated" @cancel="closeForm" /&gt;

        &lt;ul&gt;
            &lt;li v-for="music in musics" :key="music.id"&gt;
                &#123;&#123; music.title &#125;&#125; - &#123;&#123; music.artist &#125;&#125;
                &lt;button @click="editMusic(music)"&gt;Editar&lt;/button&gt;
                &lt;button @click="confirmDelete(music.id)"&gt;Excluir&lt;/button&gt;
            &lt;/li&gt;
        &lt;/ul&gt;

        &lt;ConfirmDialog v-if="showConfirmDialog" :message="'Deseja realmente excluir esta música?'"
            @confirm="deleteMusic" @cancel="closeConfirmDialog" /&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import AddMusic from './AddMusic.vue';
import EditMusic from './EditMusic.vue';
import ConfirmDialog from './ConfirmDialog.vue';

export default &#123;
    components: &#123; AddMusic, EditMusic, ConfirmDialog &#125;,
    data() &#123;
        return &#123;
            musics: [],
            showConfirmDialog: false,
            musicToDelete: null,
            editingMusic: null,
            activeForm: null,
        &#125;;
    &#125;,
    methods: &#123;
        async fetchMusics() &#123;
            try &#123;
                const response = await this.$axios.get('http://localhost:8000/api/musics/');
                this.musics = response.data;
            &#125; catch (error) &#123;
                console.error('Erro ao buscar músicas:', error);
            &#125;
        &#125;,
        showForm(formType) &#123;
            this.activeForm = formType;
            this.closeConfirmDialog();
        &#125;,
        closeForm() &#123;
            this.activeForm = null;
            this.editingMusic = null;
        &#125;,
        editMusic(music) &#123;
            this.editingMusic = &#123; ...music &#125;;
            this.showForm('edit');
        &#125;,
        onMusicUpdated() &#123;
            this.closeForm();
            this.fetchMusics();
        &#125;,
        onMusicAdded() &#123;
            this.closeForm();
            this.fetchMusics();
        &#125;,
        confirmDelete(id) &#123;
            this.closeForm();
            this.musicToDelete = id;
            this.showConfirmDialog = true;
        &#125;,
        async deleteMusic() &#123;
            try &#123;
                await this.$axios.delete(`http://localhost:8000/api/musics/$&#123;this.musicToDelete&#125;/`);
                this.fetchMusics();
                this.closeConfirmDialog();
            &#125; catch (error) &#123;
                console.error('Erro ao excluir música:', error);
            &#125;
        &#125;,
        closeConfirmDialog() &#123;
            this.showConfirmDialog = false;
            this.musicToDelete = null;
        &#125;,
    &#125;,
    created() &#123;
        this.fetchMusics();
    &#125;,
&#125;;
&lt;/script&gt;
</code></pre></small>
        </div>
    </div>


<!--Rodapé-->
<div class="row">
    <div class="col-sm-12 text-center bg-black text-light pt-4 pb-3">
        <p>Elaborado por Mateus Schwede<br><small class="text-muted">ubsocial.github.io</small></p>
    </div>
</div>

</div>
</body>
</html>